{% extends 'base.html' %}
{% block title %}Список пользователей{% endblock %}
{% block head %}
    <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.css"/>
    <link type="text/css" rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid-theme.min.css"/>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.js"></script>

    <script>
        $(function () {
            $("#jsGrid").jsGrid({
                width: "100%",
                height: "auto",
                inserting: true,
                heading: true,
                editing: true,
                filtering: true,
                sorting: true,
                paging: false,
                autoload: true,
                fields: [
                    {title: "Username", name: "username", type: "text"},
                    {title: "E-mail", name: "email", type: "text"},
                    {title: "Фамилия", name: "name_last", type: "text"},
                    {title: "Имя", name: "name_first", type: "text"},
                    {title: "Отчество", name: "name_middle", type: "text"},
                    {type: "control", modeSwitchButton: false, editButton: true}
                ],

                controller: {
                    loadData: function (filter) {
                        return $.ajax({
                            type: "POST",
                            url: "/api/user",
                            contentType: "application/json",
                            dataType: "json",
                            data: JSON.stringify({action: 'load', filter: filter})
                        });
                    },
                    insertItem: function (item) {
                        return $.ajax({
                            type: "POST",
                            url: "/api/user",
                            contentType: "application/json",
                            dataType: "json",
                            data: JSON.stringify({action: 'insert', item: item})
                        });
                    },
                    updateItem: function (item) {
                        console.log(item);
                        return $.ajax({
                            type: "POST",
                            url: "/api/user",
                            contentType: "application/json",
                            dataType: "json",
                            data: JSON.stringify({action: 'update', item: item})
                        });
                    },
                    deleteItem: function (item) {
                        return $.ajax({
                            type: "POST",
                            url: "/api/user",
                            contentType: "application/json",
                            dataType: "json",
                            data: JSON.stringify({action: 'delete', item: item})
                        });
                    }
                }
            });
        })
        ;
    </script>
{% endblock head %}

{% block body %}
    <div id="jsGrid"></div>
{% endblock body %}